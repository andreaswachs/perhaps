Thank you for installing {{ .Chart.Name }}!

Your release is named {{ .Release.Name }}.

To access Perhaps:

{{- if .Values.ingress.enabled }}
1. The application is available at:
{{- range $host := .Values.ingress.hosts }}
  {{- range .paths }}
   http{{ if $.Values.ingress.tls }}s{{ end }}://{{ $host.host }}{{ .path }}
  {{- end }}
{{- end }}
{{- else if contains "NodePort" .Values.service.type }}
1. Get the NodePort:
   export NODE_PORT=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ include "perhaps.fullname" . }}-web)
   export NODE_IP=$(kubectl get nodes --namespace {{ .Release.Namespace }} -o jsonpath="{.items[0].status.addresses[0].address}")
   echo http://$NODE_IP:$NODE_PORT
{{- else if contains "LoadBalancer" .Values.service.type }}
1. Get the external IP:
   NOTE: It may take a few minutes for the LoadBalancer IP to be available.
   kubectl get --namespace {{ .Release.Namespace }} svc {{ include "perhaps.fullname" . }}-web -w
{{- else if contains "ClusterIP" .Values.service.type }}
1. Port-forward to access the application:
   kubectl --namespace {{ .Release.Namespace }} port-forward svc/{{ include "perhaps.fullname" . }}-web 3000:{{ .Values.service.port }}
   echo "Visit http://127.0.0.1:3000"
{{- end }}

2. Check web deployment status:
   kubectl get pods -l "app.kubernetes.io/name={{ include "perhaps.name" . }},app.kubernetes.io/instance={{ .Release.Name }},app.kubernetes.io/component=web"

   View web logs:
   kubectl logs -l "app.kubernetes.io/name={{ include "perhaps.name" . }},app.kubernetes.io/component=web" -f

{{- if .Values.worker.enabled }}

3. Worker Deployment:
   -----------------
   Background job processing is enabled with {{ .Values.worker.replicaCount }} worker pod(s).

   Check worker status:
   kubectl get pods -l "app.kubernetes.io/name={{ include "perhaps.name" . }},app.kubernetes.io/instance={{ .Release.Name }},app.kubernetes.io/component=worker"

   View worker logs:
   kubectl logs -l "app.kubernetes.io/name={{ include "perhaps.name" . }},app.kubernetes.io/component=worker" -f

   Worker health check is available on port {{ .Values.worker.port }}:
   - /health - Liveness probe endpoint (checks Redis connectivity and process registration)
   - /ready  - Readiness probe endpoint (checks Redis connectivity and queue status)

{{- if .Values.worker.scheduledWorker.enabled }}
   A dedicated worker for scheduled jobs (cron) is also running.
   Check scheduled worker:
   kubectl get pods -l "app.kubernetes.io/name={{ include "perhaps.name" . }},app.kubernetes.io/component=worker-scheduled"
{{- end }}
{{- end }}

{{- if or .Values.web.hpa.enabled .Values.worker.hpa.enabled }}

Autoscaling:
-----------
Horizontal Pod Autoscaling is enabled for the following components:
{{- if .Values.web.hpa.enabled }}
  - Web: {{ .Values.web.hpa.minReplicas }} to {{ .Values.web.hpa.maxReplicas }} replicas
{{- end }}
{{- if and .Values.worker.enabled .Values.worker.hpa.enabled }}
  - Worker: {{ .Values.worker.hpa.minReplicas }} to {{ .Values.worker.hpa.maxReplicas }} replicas
{{- end }}

Monitor HPA status:
  kubectl get hpa -l "app.kubernetes.io/name={{ include "perhaps.name" . }}"
{{- end }}

{{- if or .Values.web.pdb.enabled (and .Values.worker.enabled .Values.worker.pdb.enabled) }}

Pod Disruption Budgets:
----------------------
PDBs are configured to ensure availability during cluster maintenance:
{{- if .Values.web.pdb.enabled }}
  - Web: minAvailable={{ .Values.web.pdb.minAvailable | default "1" }}
{{- end }}
{{- if and .Values.worker.enabled .Values.worker.pdb.enabled }}
  - Worker: minAvailable={{ .Values.worker.pdb.minAvailable | default "1" }}
{{- end }}

Check PDB status:
  kubectl get pdb -l "app.kubernetes.io/name={{ include "perhaps.name" . }}"
{{- end }}

For more information, visit: https://github.com/perhaps-finance/perhaps
